SDK 接入文档

# 概述

本文档面向安卓开发者，用于指导开发者快速接入 海外SDK，本 SDK 用于
Android APP
嵌入用户中心、收费模块、广告弹窗模块，提供多个接口给集成者调用。

重要提醒：

**所有的 SDK 操作都必须在应用成功授权之后才能继续执行**

**最新更新内容均已（此颜色标注）**

**开发环境**

1、建议的开发环境

开发工具：要求使用 Android Studio 3.0 版本及以上，Gradle 版本 5.4.1
版本及以上（建议 6.5），Gradle 插件（Android gradle plugin）版本 3.2.2
版本及以上（建议 3.4.3）

2、Android SDK 版本

minSdkVersion ：最低支持 Android 5.0 版本( minSdkVersion \>= 23 )；

targetSdkVersion ：推荐为30（注：部分渠道要求\<=30,部分渠道要求
\>=30，为了兼容所有渠道，此处推荐使用30）

3、Android abi 限制

请不要限制 abiFilters 仅为 armeabi，否则可能出现功能异常，请至少保留
armeabi-v7a

# 接口说明

## 1、初始化

**注意：**

必须在Application下的onCreate中初始化

## 2、授权接口

此接口必须在APP刚启动时(必须在登录之前)调用，用于给当前APP授权，**授权成功后才可以进行登录和支付**。调用方法如下：

**注意：**

UnionGame.getInstance().authorization**接口中传入的Activity不可被销毁，否则会产生Crash**

接口所需参数：

  ----------------------- ----------------------- --------------------------------
**参数**                **可否为空**            **描述**

**Activity**            不可以                  上下文

**XJAuthReq**           不可以                  授权信息

**IAuthCallback**       不可以                  授权回调对象，用于处理授权结果
  ----------------------- ----------------------- --------------------------------

**XJAuthReq 实体类**

  ------------------- --------------- ---------------------------------------------------------------------------------------------------------------------
       **字段**        **可否为空**                                                         **说明**

          pid             不可以                                                             游戏PID

         oaid             可为空                                         传oaid的值，如果无法正确获取oaid的值，则传null

     assetFileName        可为空       使用oaid版本1.0.26+以上时，需要此参数（该参数需向msa[申请证书进行获取](http://www.msa-alliance.cn/col.jsp?id=120)）

oaidLibraryString      可为空                使用oaid版本1.0.26+以上时，需要此参数，根据msa文档1.0.26对应值为 nllvm1623827671，1.0.27对应值为
nllvm1630571663641560568，1.0.30及以上对应值为msaoaidsec
  ------------------- --------------- ---------------------------------------------------------------------------------------------------------------------

**XJInitCallBack 回调说明**

+:---------------------------------+:---------------------------------------------------------------------------------------+
| **方法**                         | **说明**                                                                               |
+----------------------------------+----------------------------------------------------------------------------------------+
| onLogout()                       | 退出登录成功，游戏可调用相对应的游戏退出操作                                           |
+----------------------------------+----------------------------------------------------------------------------------------+
| onBindThirdPart(IXJUserInfo      | 以游客登录的情况下，用户绑定三方登录                                                   |
| info)                            |                                                                                        |
|                                  | 无需处理                                                                               |
+----------------------------------+----------------------------------------------------------------------------------------+
| onCancellationAccount（）        | 注销账号成功，如果用户未在15天内没有再次登录，那么账号将彻底废弃                       |
|                                  |                                                                                        |
|                                  | 无需处理                                                                               |
+----------------------------------+----------------------------------------------------------------------------------------+
| onInitSuc(int code, String s)    | 授权成功，\*\*[登录等操作请务必在此回调后再调用]{.underline}                           |
+----------------------------------+----------------------------------------------------------------------------------------+
| onInitFail(XJBaseException e)    | 授权失败;\*\*可调用退出游戏                                                            |
+----------------------------------+----------------------------------------------------------------------------------------+
| onTrackEvents(String s, String   | Sdk内部事件回调，可用于做日志追踪，统计等功能。详情请参考"sdk事件回调说明"，可不做处理 |
| s1)                              |                                                                                        |
|                                  | 无需处理                                                                               |
+----------------------------------+----------------------------------------------------------------------------------------+

**请求实例：**

UnionGame.getInstance().authorization(MainActivity.this, request, new
IAuthCallback() {

\@Override

public void onLogout() {

ToastUtil.showSucToast( \"退出登录成功Main\",MainActivity.this);

doLogin();

}

\@Override

public void onBindThirdPart(IXJUserInfo userInfo) {

}

\@Override

public void onCancellationAccount() {

}

\@Override

public void onInitFail(XJBaseException e) {

Toast.makeText(mContext, e.getMessage(), Toast.LENGTH_SHORT).show();\
//处理初始化失败，可直接调用游戏退出

}

\@Override

public void onInitSuc() {

Toast.makeText(mContext, \"初始化成功\", Toast.LENGTH_SHORT).show();

//处理初始化失败，调用登录等逻辑

}

\@Override

public void onTrackEvents(String eventName, String data) {

}

});

## 3、调用生命周期

在**游戏主页面**上添加生命周期监听方法。（必需调用，可避免掉单）

**调用生命周期方法的Activity不可被销毁，否则会产生Crash**

**实例：**

\@Override

protected void onResume() {

super.onResume();

UnionGame.getInstance().onActivityResume(this);

}

\@Override

protected void onPause() {

super.onPause();

UnionGame.getInstance().onActivityPause();

}

\@Override

protected void onDestroy() {

// 必须在super.onDestroy()之前调用

UnionGame.getInstance().onActivityDestroy(this);

super.onDestroy();

}

\@Override

protected void onActivityResult(int requestCode, int resultCode, Intent
data) {

super.onActivityResult(requestCode, resultCode, data);

UnionGame.getInstance().onActivityResult(requestCode, resultCode, data);

}

## 4、登陆接口

此接口请在授权完成后的登录操作调用。此接口调用方法如下：

接口所需参数：

+:-------------------+:--------------+:----------------------------------+
| **参数**           | **可否为空**  | > **说明**                        |
+--------------------+---------------+-----------------------------------+
| **Activity         | 不可以        | > 上下文                          |
| activity**         |               |                                   |
+--------------------+---------------+-----------------------------------+
| **ILoginCallback** | 不可以        | > 处理注册、登录结果的回调        |
|                    |               |                                   |
| > **callBack**     |               |                                   |
+--------------------+---------------+-----------------------------------+

**LoginModeCallBack 回调说明**

  ----------------------------------- -----------------------------------
**方法**                            **说明**

onLoginModeSuccess(IXJUserInfo      登录成功
info)

onLoginModeFail(XJBaseException e)  登录失败

onLoginModeCancel()                 用户登录取消
  ----------------------------------- -----------------------------------

**IXJUserInfo 说明**

  ----------------------------------- -----------------------------------
**方法**                            **说明**

getXJUserNo                         用户名(cp用户唯一标识码)

getXJLoginName                      用户名

getXJToken                          token(用于登录验证)
  ----------------------------------- -----------------------------------

## 5、支付接口

此接口请在授权完成后调用。用于处理页面逻辑。真正是否支付成功，由你们服务端通知你。此接口调用方法如下：

**接口所需参数：**

+:--------------------------+:----------------+:----------------------+
| **参数**                  | **可否为空**    | > **说明**            |
+---------------------------+-----------------+-----------------------+
| **Activity activity**     | 不可以          | > 上下文              |
+---------------------------+-----------------+-----------------------+
| **XJOrderReq request**    | 不可以          | > 订单信息            |
+---------------------------+-----------------+-----------------------+
| **IPayCallback callBack** | 不可以          | > 处理支付结果的回调  |
+---------------------------+-----------------+-----------------------+

**XJOrderReq实体类**

+:-------------------+:-------------------+:--------------------------+
| **字段**           | > **可否为空**     | > **说明**                |
+--------------------+--------------------+---------------------------+
| **loginName**      | > 不可以           | 登录信息-登录名           |
+--------------------+--------------------+---------------------------+
| **userNo**         | > 不可以           | 登录信息-用户唯一标识     |
+--------------------+--------------------+---------------------------+
| **amount**         | > 不可以           | 订单金额(元)              |
+--------------------+--------------------+---------------------------+
| **companyOrderNo** | > 不可以           | **唯一订单号**            |
+--------------------+--------------------+---------------------------+
| **gamersRole**     | > 不可以           | 角色名                    |
+--------------------+--------------------+---------------------------+
| **gamersRoleId**   | > 不可以           | 角色ID                    |
+--------------------+--------------------+---------------------------+
| **serverNum**      | > 不可以           | 区服ID                    |
+--------------------+--------------------+---------------------------+
| **serverName**     | > 不可以           | 区服名称                  |
+--------------------+--------------------+---------------------------+
| **grade**          | > 不可以           | 等级                      |
+--------------------+--------------------+---------------------------+
| **resourceId**     | > 不可以           | 内购ID(运营人员提供)      |
+--------------------+--------------------+---------------------------+
| **productName**    | > 不可以           | 商品名称                  |
+--------------------+--------------------+---------------------------+
| **productDes**     | > 可以             | 商品描述                  |
+--------------------+--------------------+---------------------------+
| **extra**          | > 可以             | 备注                      |
+--------------------+--------------------+---------------------------+

**IPayCallback 回调说明**

  ---------------------------------- ------------------------------------
**方法**                           **说明**

onSuccess()                        支付成功

onFailed(XJPayException e)         支付失败

onCancel()                         取消支付
  ---------------------------------- ------------------------------------

**实例**

XJOrderReq request = new XJOrderReq();

request.setUserNo(userNo);

request.setLoginName(mLoginName);

request.setAmount(rechargePrice);

request.setCompanyOrderNo(companyOrderNo);

request.setGamersRoleId(gamersRoleId);

request.setGamersRole(gamersRole);

request.setProductName(productName);

request.setProductDes(productDes);

request.setServerName(serverName);

request.setServerNum(serverNum);

request.setGrade(grade);

request.setResourceID(resourceID);

request.setExtra(extra);

UnionGame.getInstance().pay(MainActivity.this, request, new
IPayCallBack() {

\@Override

public void onSuccess() {

ToastUtil.showToast(\"支付成功\", MainActivity.this);

}

\@Override

public void onFailed(XJPayException e) {

ToastUtil.showToast(\"支付失败：\" + e.getMessage(), MainActivity.this);

}

\@Override

public void onCancel() {

ToastUtil.showToast(\"支付取消：\", MainActivity.this);

}

});

## 6、应用退出接口（请务必接入）

此接口请在程序退出的时候调用，此接口调用方法如下：

**接口所需参数:**

+:-----------------------------+:-----------------+:-------------------+
| **参数**                     | **可否为空**     | > **说明**         |
+------------------------------+------------------+--------------------+
| **Activity**                 | 不可以           | 上下文             |
+------------------------------+------------------+--------------------+
| IExitCallBack                | 不可以           | 处理退出结果的事件 |
+------------------------------+------------------+--------------------+

**ExitCallBack 回调说明**

  ---------------------------------- ------------------------------------
**方法**                           **说明**

onExit()                           退出成功
  ---------------------------------- ------------------------------------

**实例：**

\@Override

public boolean onKeyDown(int keyCode, KeyEvent event) {

if (keyCode == KeyEvent.KEYCODE_BACK) {

UnionGame.getInstance().showExitTipDialog(this, new ExitCallBack() {

\@Override

public void onExit() {

System.out.println(\"游戏退出了\");

}

});

return true;

}

if (keyCode == KeyEvent.KEYCODE_HOME) {

return true;

}

return super.onKeyDown(keyCode, event);

}

## 7、提交角色信息接口

此接口必须在授权成功后调用, 调用方法如下：

+:--------------------------+:---------------+:------------------------+
| > **参数**                | > **可否为空** | > **说明**              |
+---------------------------+----------------+-------------------------+
| **Activity activity**     | > 不可以       | > 上下文                |
+---------------------------+----------------+-------------------------+
| XJRoleReq **request**     | > 不可以       | > 角色信息              |
+---------------------------+----------------+-------------------------+
| **ISubmitUserRoleCallBack | > 不可以       | > 处理支付结果的回调    |
| CallBack**                |                |                         |
+---------------------------+----------------+-------------------------+

**XJRoleReq实体类**

+:-------------------+:------------------:+:----------------------------------------------------------------:+
| > 字段             | > 可否为空         | > 说明                                                           |
+--------------------+--------------------+------------------------------------------------------------------+
| **loginName**      | > 不可以           | 登录信息-登录名                                                  |
+--------------------+--------------------+------------------------------------------------------------------+
| **userNo**         | > 不可以           | 登录信息-用户唯一标识                                            |
+--------------------+--------------------+------------------------------------------------------------------+
| **gamersGrade**    | > 不可以           | 等级                                                             |
+--------------------+--------------------+------------------------------------------------------------------+
| **gamersRoleId**   | > 不可以           | 角色ID                                                           |
+--------------------+--------------------+------------------------------------------------------------------+
| **serverNum**      | > 不可以           | 区服ID                                                           |
+--------------------+--------------------+------------------------------------------------------------------+
| **gamersRole**     | > 不可以           | 角色名称                                                         |
+--------------------+--------------------+------------------------------------------------------------------+
| **serverName**     | > 不可以           | 区服名称                                                         |
+--------------------+--------------------+------------------------------------------------------------------+
| **type**           | > 不可以           | 1、创建角色接口2、角色进入游戏接口3、角色升级接口4、角色改名接口 |
+--------------------+--------------------+------------------------------------------------------------------+

SubmitUserRoleCallBack **回调说明**

  ---------------------------------- ------------------------------------
**方法**                           **说明**

onSubmitSuccess()                  提交角色成功

onSubmitFailed()                   提交角色失败
  ---------------------------------- ------------------------------------

**实例：**

XJRoleReq request = new XJRoleReq ();

request.setUserNo(userNo);

request.setLoginName(mLoginName);

request.setGamersGrade(gameGrade);

request.setGamersRole(gameRoleName);

request.setGameId(gameId);

request.setGamersRoleId(gameRoleId);

request.setServerNum(\"1区\");

request.setServerName(\"大圣归来\");

request.setVersionCode(systemVersion);

Request.setType(1)

UnionGame.getInstance().submitUserGameRole(MainActivity.this, request,
new ISubmitRoleCallback() {

\@Override

public void onSubmitSuccess() {

Log.e(\"onSubmitSuccess\", \"提交成功\");

}

\@Override

public void onSubmitFailed() {

Log.e(\"onSubmitFailed\", \"提交失败\");

}

});

## 退出登录(可选)

此接口用于手动退出登录, 游戏中若自带切换帐号入口, 请调用该接口方法,
并在相应的回调方法中onLogout 做相关处理。

该渠道如果不存在退出登录，会在 '快速对接文档_安卓端' 的注意中标注

# 注意事项

## 1、所有 SDK 接口调用 都需要在调用授权接口成功以后才能继续执行

## 2、接口请在主线程调用

## 3、Apk请勿加固
